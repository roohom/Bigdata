# 数据仓库

## 概念

数据库与数据仓库都是事先数据存储的一种设计模型

## 功能

- 更加规范和统一化的数据管理平台
- 将企业需要的所有数据进行存储，提供给企业各个需要使用数据的部门进行应用

## 特点

- 专门用于设计存储数据的地方
- 本身不产生数据
- 本身不使用数据
- 面向主题：不同的应用给定不同的主题，用到不同的数据
  - 对数据按照需求分类

## 流程

- 数据生成
  - 业务数据：数据库
  - 用户行为数据：日志
  - 机器运行日志：日志
  - 爬虫数据
  - 第三方合作数据
- 数据采集：通过各种采集工具将不同类型的数据存储在数据仓库中
  - 先放入HDFS
- ETL：数据清洗
  - 过滤、转换、补全
  - 对HDFS上的原始数据进行处理，处理好的数据放入数仓
- 数据仓库：将各种各样的数据进行统一化的存储
  - 分层：规范所有数据进入数仓以后经过哪些步骤的处理，得到最后想要的结果
    - 原始数据：ETL
    - 第一层：存储ETL之后的数据
    - 第二层：对第一层之后的数据简单处理
    - 第三层：第二层之后的数据进行处理
    - 第四层：得到需求方需要的数据
- 构建数据仓库：
  - 离线数仓：Hive



# Hive

> 起源自：FaceBook

- Hive提供SQL的开发接口，用户可以直接使用SQL来操作Hadoop

- Hive本身只是一个翻译的角色，底层分布式存储和分布式计算都是靠Hadoop来实现的

- 高度依赖于Hadoop

## 本质

一种特殊的支持SQL开发接口的Hadoop客户端



## 功能

- **将文件映射成表的数据**[工作中主要使用此功能构建数仓]
  - Hive的存储：HDFS
- 功能二：将SQL语句转换为MapReduce程序，提交给yarn运行[工作中使用较少，替代品：Impala、SparkSQL
  - MapReduce是对文件进行操作
  - SQL是对表进行操作
  - Hive是对表处理的，底层的MapReduce是对文件进行处理的

## 应用场景

应用于构建**数据仓库**

## 架构

- 客户端：用于提供与用户交互的界面，实现SQL开发

- 服务端：

  - 负责分析SQL，读写元数据，提交程序给Hadoop
  - 连接器：负责维护与客户端的连接
  - 解析器：负责解析SQL语句构建语法树
    - 判断数据库、表是否存在
    - 语法是否正确
    - 最终得到一个逻辑计划
  - 优化器：优化这个逻辑，得到物理计划
  - 执行器：执行物理计划得到结果返回给客户端

- 元数据：存储Hive中关键性信息
  - Hive中所有数据库、所有表的信息
  - HDFS与Hive表的映射关系
  
- Hadoop：Hive所有的请求都是给Hadoop**实现**的
  - Hive自己不是分布式的
  - Hive能实现分布式存储和分布式计算
  - 底层：
    - 存储：HDFS
    
    - 计算：MapReduce+yarn
    
      

## 元数据服务

- 存储内容：Hive中关键性数据，数据库、表、列的信息
- 存储位置
  - 默认位置：derby数据库
    - Hive自带的文本型数据库，轻量级的数据库
    - 一般用于嵌入式系统中的数据存储
    - 不方便管理和维护不方便共享
  - 自定义位置：MySQL
    - 官方推荐使用的存储方式
    - 工作中使用的方式(几乎所有的元数据都存放在MySQL)
- 元数据的**访问**方式：**内嵌模式**、**本地模式**、**远程模式**
  - 内嵌模式：元数据使用默认存储，直接访问derby
  - 本地模式：元数据使用RDBMS(关系型数据库管理系统)：MySQL，Hive
    - RDBMS：关系型数据库管理系统
    - NoSQL：非关系型数据库
  - 远程模式：元数据

### 元数据共享

- 使用Spark/Impala/presto等对Hive中的数据进行计算从而代替hive底层的MapReduce计算，如何实现？
  - 解决：所有的数据都存储在元数据中，只要将Hive元数据共享刚给其他工具即可





